{"ast":null,"code":"import _asyncToGenerator from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/regenerator/index.js\";import{useState,useEffect}from'react';import toast from'react-hot-toast';import{useLocation,useHistory}from'react-router-dom';import Notification from'../components/Notification';import{checkAuthToken,refreshAuthToken}from'../Signup/fetches';import PeerformanceLogo from\"../assets/peerformance_logo.svg\";import{PAGES}from'../constants/en';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EmailAuth=function EmailAuth(){var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),isAuth=_useState2[0],setIsAuth=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),supervisorEmail=_useState6[0],setSupervisorEmail=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),submiterEmail=_useState8[0],setSubmiterEmail=_useState8[1];var _useLocation=useLocation(),search=_useLocation.search;var history=useHistory();useEffect(function(){var params=new URLSearchParams(search);var token=params.get('token');if(token){var verifyAuthToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _response$data,_response$data2,_response$data3,response,_supervisorEmail,userEmail;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return checkAuthToken(token);case 3:response=_context.sent;if(response&&(_response$data=response.data)!==null&&_response$data!==void 0&&_response$data.tokenValid){setIsAuth(true);}else{setIsAuth(false);setError(response.data.error);}_supervisorEmail=response===null||response===void 0?void 0:(_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.supervisorEmail;userEmail=response===null||response===void 0?void 0:(_response$data3=response.data)===null||_response$data3===void 0?void 0:_response$data3.userEmail;if(_supervisorEmail)setSupervisorEmail(_supervisorEmail);if(userEmail)setSubmiterEmail(userEmail);_context.next=15;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);console.error(PAGES.EMAIL_AUTH.MESSAGES.TOKEN_FAILED,_context.t0);setIsAuth(false);case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function verifyAuthToken(){return _ref.apply(this,arguments);};}();verifyAuthToken();}},[]);var handleRefreshAuthToken=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return refreshAuthToken(submiterEmail,supervisorEmail);case 2:setError(null);toast.success(PAGES.EMAIL_AUTH.MESSAGES.ACTIVATION_LINK_SENT,{duration:6000,position:'top-center'});history.push('/');case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleRefreshAuthToken(){return _ref2.apply(this,arguments);};}();return isAuth!==undefined?isAuth?/*#__PURE__*/_jsx(\"div\",{className:\"row email-auth\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-5 col-sm-12 mx-auto\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"w-50 mx-auto d-block mt-5\",src:PeerformanceLogo,alt:\"Peerformance Logo\",width:\"263\",height:\"121\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-success notification-message mt-4\",role:\"alert\",children:/*#__PURE__*/_jsx(\"p\",{className:\"m-0\",children:PAGES.EMAIL_AUTH.MESSAGES.SUCCESSFULLY_AUTHORIZED})})]})}):error?/*#__PURE__*/_jsx(\"div\",{className:\"row email-auth\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-5 col-sm-12 mx-auto\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"w-50 mx-auto d-block mt-5\",src:PeerformanceLogo,alt:\"Peerformance Logo\",width:\"263\",height:\"121\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-warning notification-message mt-4\",role:\"alert\",children:/*#__PURE__*/_jsxs(\"p\",{children:[error,\".\",/*#__PURE__*/_jsx(\"br\",{}),\"If you would like to renew the authorization process,\",/*#__PURE__*/_jsx(\"br\",{}),\"click on this link\",' ',/*#__PURE__*/_jsx(\"span\",{className:\"text-decoration-underline text-primary c-pointer\",onClick:handleRefreshAuthToken,children:\"link\"}),' ',\"and check your e-mail address to complete the authorization process.\"]})})]})}):/*#__PURE__*/_jsx(\"div\",{className:\"row email-auth\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-5 col-sm-12 mx-auto\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"w-50 mx-auto d-block mt-5\",src:PeerformanceLogo,alt:\"Peerformance Logo\",width:\"263\",height:\"121\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Notification,{type:\"danger\",message:\"Invalid token\"})]})}):null;};export default EmailAuth;","map":{"version":3,"sources":["/home/mspl/Desktop/peerformance_frontend/src/pages/EmailAuth.jsx"],"names":["useState","useEffect","toast","useLocation","useHistory","Notification","checkAuthToken","refreshAuthToken","PAGES","EmailAuth","undefined","isAuth","setIsAuth","error","setError","supervisorEmail","setSupervisorEmail","submiterEmail","setSubmiterEmail","search","history","params","URLSearchParams","token","get","verifyAuthToken","response","data","tokenValid","userEmail","console","EMAIL_AUTH","MESSAGES","TOKEN_FAILED","handleRefreshAuthToken","success","ACTIVATION_LINK_SENT","duration","position","push","PeerformanceLogo","SUCCESSFULLY_AUTHORIZED"],"mappings":"6XAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,MAAOC,CAAAA,KAAP,KAAkB,iBAAlB,CACA,OAASC,WAAT,CAAsBC,UAAtB,KAAwC,kBAAxC,CACA,MAAOC,CAAAA,YAAP,KAAyB,4BAAzB,CACA,OAASC,cAAT,CAAyBC,gBAAzB,KAAiD,mBAAjD,C,8DAEA,OAASC,KAAT,KAAsB,iBAAtB,C,wFAEA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAM,CACvB,cAA4BT,QAAQ,CAACU,SAAD,CAApC,wCAAOC,MAAP,eAAeC,SAAf,eACA,eAA0BZ,QAAQ,CAAC,IAAD,CAAlC,yCAAOa,KAAP,eAAcC,QAAd,eACA,eAA8Cd,QAAQ,CAAC,IAAD,CAAtD,yCAAOe,eAAP,eAAwBC,kBAAxB,eACA,eAA0ChB,QAAQ,CAAC,IAAD,CAAlD,yCAAOiB,aAAP,eAAsBC,gBAAtB,eACA,iBAAmBf,WAAW,EAA9B,CAAQgB,MAAR,cAAQA,MAAR,CACA,GAAMC,CAAAA,OAAO,CAAGhB,UAAU,EAA1B,CAEAH,SAAS,CAAC,UAAM,CACf,GAAMoB,CAAAA,MAAM,CAAG,GAAIC,CAAAA,eAAJ,CAAoBH,MAApB,CAAf,CACA,GAAMI,CAAAA,KAAK,CAAGF,MAAM,CAACG,GAAP,CAAW,OAAX,CAAd,CAEA,GAAID,KAAJ,CAAW,CACV,GAAME,CAAAA,eAAe,0FAAG,gQAECnB,CAAAA,cAAc,CAACiB,KAAD,CAFf,QAEhBG,QAFgB,eAItB,GAAIA,QAAQ,kBAAIA,QAAQ,CAACC,IAAb,mCAAI,eAAeC,UAA/B,CAA2C,CAC1ChB,SAAS,CAAC,IAAD,CAAT,CACA,CAFD,IAEO,CACNA,SAAS,CAAC,KAAD,CAAT,CACAE,QAAQ,CAACY,QAAQ,CAACC,IAAT,CAAcd,KAAf,CAAR,CACA,CAEKE,gBAXgB,CAWEW,QAXF,SAWEA,QAXF,kCAWEA,QAAQ,CAAEC,IAXZ,0CAWE,gBAAgBZ,eAXlB,CAYhBc,SAZgB,CAYJH,QAZI,SAYJA,QAZI,kCAYJA,QAAQ,CAAEC,IAZN,0CAYJ,gBAAgBE,SAZZ,CAatB,GAAId,gBAAJ,CAAqBC,kBAAkB,CAACD,gBAAD,CAAlB,CACrB,GAAIc,SAAJ,CAAeX,gBAAgB,CAACW,SAAD,CAAhB,CAdO,iFAgBtBC,OAAO,CAACjB,KAAR,CAAcL,KAAK,CAACuB,UAAN,CAAiBC,QAAjB,CAA0BC,YAAxC,cACArB,SAAS,CAAC,KAAD,CAAT,CAjBsB,qEAAH,kBAAfa,CAAAA,eAAe,0CAArB,CAoBAA,eAAe,GACf,CACD,CA3BQ,CA2BN,EA3BM,CAAT,CA6BA,GAAMS,CAAAA,sBAAsB,2FAAG,+JACxB3B,CAAAA,gBAAgB,CAACU,aAAD,CAAgBF,eAAhB,CADQ,QAE9BD,QAAQ,CAAC,IAAD,CAAR,CACAZ,KAAK,CAACiC,OAAN,CAAc3B,KAAK,CAACuB,UAAN,CAAiBC,QAAjB,CAA0BI,oBAAxC,CAA8D,CAC7DC,QAAQ,CAAE,IADmD,CAE7DC,QAAQ,CAAE,YAFmD,CAA9D,EAIAlB,OAAO,CAACmB,IAAR,CAAa,GAAb,EAP8B,wDAAH,kBAAtBL,CAAAA,sBAAsB,2CAA5B,CAUA,MAAOvB,CAAAA,MAAM,GAAKD,SAAX,CACNC,MAAM,cACL,YAAK,SAAS,CAAC,gBAAf,uBACC,aAAK,SAAS,CAAC,4BAAf,wBACC,YACC,SAAS,CAAC,2BADX,CAEC,GAAG,CAAE6B,gBAFN,CAGC,GAAG,CAAC,mBAHL,CAIC,KAAK,CAAC,KAJP,CAKC,MAAM,CAAC,KALR,EADD,cAQC,aARD,cASC,YAAK,SAAS,CAAC,+CAAf,CAA+D,IAAI,CAAC,OAApE,uBACC,UAAG,SAAS,CAAC,KAAb,UAAoBhC,KAAK,CAACuB,UAAN,CAAiBC,QAAjB,CAA0BS,uBAA9C,EADD,EATD,GADD,EADK,CAgBF5B,KAAK,cACR,YAAK,SAAS,CAAC,gBAAf,uBACC,aAAK,SAAS,CAAC,4BAAf,wBACC,YACC,SAAS,CAAC,2BADX,CAEC,GAAG,CAAE2B,gBAFN,CAGC,GAAG,CAAC,mBAHL,CAIC,KAAK,CAAC,KAJP,CAKC,MAAM,CAAC,KALR,EADD,cAQC,aARD,cASC,YAAK,SAAS,CAAC,+CAAf,CAA+D,IAAI,CAAC,OAApE,uBACC,qBACE3B,KADF,kBAEC,aAFD,sEAIC,aAJD,sBAKoB,GALpB,cAMC,aACC,SAAS,CAAC,kDADX,CAEC,OAAO,CAAEqB,sBAFV,kBAND,CAWS,GAXT,0EADD,EATD,GADD,EADQ,cA8BP,YAAK,SAAS,CAAC,gBAAf,uBACC,aAAK,SAAS,CAAC,4BAAf,wBACC,YACC,SAAS,CAAC,2BADX,CAEC,GAAG,CAAEM,gBAFN,CAGC,GAAG,CAAC,mBAHL,CAIC,KAAK,CAAC,KAJP,CAKC,MAAM,CAAC,KALR,EADD,cAQC,aARD,cASC,KAAC,YAAD,EAAc,IAAI,CAAC,QAAnB,CAA4B,OAAO,CAAC,eAApC,EATD,GADD,EA/CI,CA6DH,IA7DJ,CA8DA,CA7GD,CA+GA,cAAe/B,CAAAA,SAAf","sourcesContent":["import { useState, useEffect } from 'react';\nimport toast from 'react-hot-toast';\nimport { useLocation, useHistory } from 'react-router-dom';\nimport Notification from '../components/Notification';\nimport { checkAuthToken, refreshAuthToken } from '../Signup/fetches';\nimport PeerformanceLogo from '../assets/peerformance_logo.svg';\nimport { PAGES } from '../constants/en';\n\nconst EmailAuth = () => {\n\tconst [isAuth, setIsAuth] = useState(undefined);\n\tconst [error, setError] = useState(null);\n\tconst [supervisorEmail, setSupervisorEmail] = useState(null);\n\tconst [submiterEmail, setSubmiterEmail] = useState(null);\n\tconst { search } = useLocation();\n\tconst history = useHistory();\n\n\tuseEffect(() => {\n\t\tconst params = new URLSearchParams(search);\n\t\tconst token = params.get('token');\n\n\t\tif (token) {\n\t\t\tconst verifyAuthToken = async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await checkAuthToken(token);\n\n\t\t\t\t\tif (response && response.data?.tokenValid) {\n\t\t\t\t\t\tsetIsAuth(true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetIsAuth(false);\n\t\t\t\t\t\tsetError(response.data.error);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst supervisorEmail = response?.data?.supervisorEmail;\n\t\t\t\t\tconst userEmail = response?.data?.userEmail;\n\t\t\t\t\tif (supervisorEmail) setSupervisorEmail(supervisorEmail);\n\t\t\t\t\tif (userEmail) setSubmiterEmail(userEmail);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(PAGES.EMAIL_AUTH.MESSAGES.TOKEN_FAILED, error);\n\t\t\t\t\tsetIsAuth(false);\n\t\t\t\t}\n\t\t\t};\n\t\t\tverifyAuthToken();\n\t\t}\n\t}, []);\n\n\tconst handleRefreshAuthToken = async () => {\n\t\tawait refreshAuthToken(submiterEmail, supervisorEmail);\n\t\tsetError(null);\n\t\ttoast.success(PAGES.EMAIL_AUTH.MESSAGES.ACTIVATION_LINK_SENT, {\n\t\t\tduration: 6000,\n\t\t\tposition: 'top-center',\n\t\t});\n\t\thistory.push('/');\n\t};\n\n\treturn isAuth !== undefined ? (\n\t\tisAuth ? (\n\t\t\t<div className='row email-auth'>\n\t\t\t\t<div className='col-md-5 col-sm-12 mx-auto'>\n\t\t\t\t\t<img\n\t\t\t\t\t\tclassName='w-50 mx-auto d-block mt-5'\n\t\t\t\t\t\tsrc={PeerformanceLogo}\n\t\t\t\t\t\talt='Peerformance Logo'\n\t\t\t\t\t\twidth='263'\n\t\t\t\t\t\theight='121'\n\t\t\t\t\t/>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<div className='alert alert-success notification-message mt-4' role='alert'>\n\t\t\t\t\t\t<p className='m-0'>{PAGES.EMAIL_AUTH.MESSAGES.SUCCESSFULLY_AUTHORIZED}</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t) : error ? (\n\t\t\t<div className='row email-auth'>\n\t\t\t\t<div className='col-md-5 col-sm-12 mx-auto'>\n\t\t\t\t\t<img\n\t\t\t\t\t\tclassName='w-50 mx-auto d-block mt-5'\n\t\t\t\t\t\tsrc={PeerformanceLogo}\n\t\t\t\t\t\talt='Peerformance Logo'\n\t\t\t\t\t\twidth='263'\n\t\t\t\t\t\theight='121'\n\t\t\t\t\t/>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<div className='alert alert-warning notification-message mt-4' role='alert'>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t{error}.\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\tIf you would like to renew the authorization process,\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\tclick on this link{' '}\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclassName='text-decoration-underline text-primary c-pointer'\n\t\t\t\t\t\t\t\tonClick={handleRefreshAuthToken}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tlink\n\t\t\t\t\t\t\t</span>{' '}\n\t\t\t\t\t\t\tand check your e-mail address to complete the authorization process.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t) : (\n\t\t\t\t<div className='row email-auth'>\n\t\t\t\t\t<div className='col-md-5 col-sm-12 mx-auto'>\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tclassName='w-50 mx-auto d-block mt-5'\n\t\t\t\t\t\t\tsrc={PeerformanceLogo}\n\t\t\t\t\t\t\talt='Peerformance Logo'\n\t\t\t\t\t\t\twidth='263'\n\t\t\t\t\t\t\theight='121'\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<Notification type='danger' message='Invalid token' />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)\n\t) : null;\n};\n\nexport default EmailAuth;\n"]},"metadata":{},"sourceType":"module"}