{"ast":null,"code":"import _asyncToGenerator from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _classCallCheck from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import _regeneratorRuntime from\"/home/mspl/Desktop/peerformance_frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{Component}from'react';import toast from'react-hot-toast';import*as fetches from'./fetches';import PeerformanceLogo from\"../assets/peerformance_logo.svg\";import SecurityQuestionsPage from'./components/SecurityQuestionsPage';import SubmitPage from'./components/SubmitPage';import Notification from'../components/Notification';import{withRouter}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CompanyInformations=/*#__PURE__*/function(_Component){_inherits(CompanyInformations,_Component);var _super=_createSuper(CompanyInformations);function CompanyInformations(){var _this;_classCallCheck(this,CompanyInformations);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={isAuth:undefined,tokenError:null,page:1,userEmail:'',questionsForm:{firstQuestion:{value:''},firstAnswer:{value:'',isValid:true},secondQuestion:{value:''},secondAnswer:{value:'',isValid:true}},companyInfoForm:{isFilled:false,organizationId:null,name:{value:''},numberOfEmployees:{value:''},annualRevenue:{value:''},reach:{value:''},authorizationContactEmail:{value:'',isValid:true}}};_this.nextPage=function(){return _this.setState({page:2});};_this.setIsAuth=function(isAuth){return _this.setState({isAuth:isAuth});};_this.setQuestionFormValue=function(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;_this.setState(function(state){return{questionsForm:_objectSpread(_objectSpread({},state.questionsForm),{},_defineProperty({},name,_objectSpread(_objectSpread({},state.questionsForm[name]),{},{value:value})))};});};_this.setCompanyInfoFormValue=function(e){var _e$target2=e.target,name=_e$target2.name,value=_e$target2.value;_this.setState(function(state,_props){return{companyInfoForm:_objectSpread(_objectSpread({},state.companyInfoForm),{},_defineProperty({},name,_objectSpread(_objectSpread({},state.companyInfoForm[name]),{},{value:value})))};});};_this.setAuthorizationContactEmail=function(value){_this.setState(function(state,_props){return{companyInfoForm:_objectSpread(_objectSpread({},state.companyInfoForm),{},{authorizationContactEmail:_objectSpread(_objectSpread({},state.companyInfoForm.authorizationContactEmail),{},{value:value})})};});};_this.onSubmit=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var userData,updatedUserData,response,companyData,_updatedUserData,_response,_response2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:userData={email:_this.state.userEmail,firstQuestion:parseInt(_this.state.questionsForm.firstQuestion.value,10),firstAnswer:_this.state.questionsForm.firstAnswer.value,secondQuestion:parseInt(_this.state.questionsForm.secondQuestion.value,10),secondAnswer:_this.state.questionsForm.secondAnswer.value,authorizationContactEmail:_this.state.companyInfoForm.authorizationContactEmail.value};if(!_this.state.companyInfoForm.isFilled){_context.next=15;break;}updatedUserData=Object.assign({organizationId:_this.state.companyInfoForm.organizationId},userData);_context.prev=3;_context.next=6;return fetches.createUser(updatedUserData);case 6:response=_context.sent;toast.success(response.data.message,{duration:6000,position:'top-center'});_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](3);console.log(_context.t0);case 13:_context.next=37;break;case 15:companyData={name:_this.state.companyInfoForm.name.value,numberOfEmployees:parseInt(_this.state.companyInfoForm.numberOfEmployees.value,10),annualRevenue:parseInt(_this.state.companyInfoForm.annualRevenue.value,10),reach:parseInt(_this.state.companyInfoForm.reach.value,10),domain:_this.state.userEmail.split('@')[1]};_updatedUserData=Object.assign({organizationId:null},userData);_context.prev=17;_context.next=20;return fetches.createCompany(companyData);case 20:_response=_context.sent;_updatedUserData.organizationId=_response.data.organizationId;_context.next=27;break;case 24:_context.prev=24;_context.t1=_context[\"catch\"](17);console.log(_context.t1);case 27:_context.prev=27;_context.next=30;return fetches.createUser(_updatedUserData);case 30:_response2=_context.sent;toast.success(_response2.data.message,{duration:6000,position:'top-center'});_context.next=37;break;case 34:_context.prev=34;_context.t2=_context[\"catch\"](27);console.log(_context.t2);case 37:_this.props.history.push('/');case 38:case\"end\":return _context.stop();}}},_callee,null,[[3,10],[17,24],[27,34]]);}));_this.handleRefreshToken=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetches.refreshToken(_this.state.userEmail);case 2:_this.setState({tokenError:null});toast.success('Activation link has been sent.',{duration:6000,position:'top-center'});_this.props.history.push('/');case 5:case\"end\":return _context2.stop();}}},_callee2);}));return _this;}_createClass(CompanyInformations,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var search,params,token,_response$data,_response$data2,response,organizationData,userEmail;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:search=this.props.location.search;params=new URLSearchParams(search);token=params.get('token');if(!token){_context3.next=17;break;}_context3.prev=4;_context3.next=7;return fetches.checkToken(token);case 7:response=_context3.sent;if(response&&(_response$data=response.data)!==null&&_response$data!==void 0&&_response$data.tokenValid){this.setIsAuth(true);organizationData=response===null||response===void 0?void 0:response.data.organization;if(organizationData){this.setState({companyInfoForm:_objectSpread(_objectSpread({},this.state.companyInfoForm),{},{isFilled:true,organizationId:organizationData.id,name:{value:organizationData.Name},numberOfEmployees:{value:organizationData.NumberOfEmployeesID},annualRevenue:{value:organizationData.AnnualRevenueID},reach:{value:organizationData.ReachID}})});}}else{this.setState({isAuth:false,tokenError:response.data.error});}userEmail=response===null||response===void 0?void 0:(_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.email;if(userEmail)this.setState({userEmail:userEmail});_context3.next=17;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](4);console.error('Token failed: ',_context3.t0);this.setIsAuth(false);case 17:case\"end\":return _context3.stop();}}},_callee3,this,[[4,13]]);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this$state=this.state,questionsForm=_this$state.questionsForm,companyInfoForm=_this$state.companyInfoForm,isAuth=_this$state.isAuth,tokenError=_this$state.tokenError;return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-5 col-sm-12 mx-auto\",children:/*#__PURE__*/_jsxs(\"form\",{noValidate:true,className:\"w-100\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"w-50 mx-auto d-block mt-5\",src:PeerformanceLogo,alt:\"Peerformance Logo\",width:\"263\",height:\"121\"}),/*#__PURE__*/_jsx(\"br\",{}),isAuth!==undefined?isAuth?/*#__PURE__*/_jsx(\"div\",{className:\"row mt-3\",children:this.state.page===1?/*#__PURE__*/_jsx(SecurityQuestionsPage,{form:questionsForm,onChange:this.setQuestionFormValue,onNextButtonClick:this.nextPage}):/*#__PURE__*/_jsx(SubmitPage,{form:companyInfoForm,onChange:this.setCompanyInfoFormValue,onSubmit:this.onSubmit,userEmail:this.state.userEmail,setAuthorizationContactEmail:this.setAuthorizationContactEmail})}):tokenError?/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-warning notification-message mt-4\",role:\"alert\",children:/*#__PURE__*/_jsxs(\"p\",{children:[tokenError,\".\",/*#__PURE__*/_jsx(\"br\",{}),\"If you would like to renew the account creation process,\",/*#__PURE__*/_jsx(\"br\",{}),\"click on this link\",' ',/*#__PURE__*/_jsx(\"span\",{className:\"text-decoration-underline text-primary c-pointer\",onClick:this.handleRefreshToken,children:\"link\"}),' ',\"and check your e-mail address to complete the activation process.\"]})}):/*#__PURE__*/_jsx(Notification,{type:\"danger\",message:\"Invalid token\"}):null]})})})});}}]);return CompanyInformations;}(Component);export default withRouter(CompanyInformations);","map":{"version":3,"sources":["/home/mspl/Desktop/peerformance_frontend/src/Signup/CompanyInformations.jsx"],"names":["React","Component","toast","fetches","SecurityQuestionsPage","SubmitPage","Notification","withRouter","CompanyInformations","state","isAuth","undefined","tokenError","page","userEmail","questionsForm","firstQuestion","value","firstAnswer","isValid","secondQuestion","secondAnswer","companyInfoForm","isFilled","organizationId","name","numberOfEmployees","annualRevenue","reach","authorizationContactEmail","nextPage","setState","setIsAuth","setQuestionFormValue","e","target","setCompanyInfoFormValue","_props","setAuthorizationContactEmail","onSubmit","userData","email","parseInt","updatedUserData","Object","assign","createUser","response","success","data","message","duration","position","console","log","companyData","domain","split","createCompany","props","history","push","handleRefreshToken","refreshToken","search","location","params","URLSearchParams","token","get","checkToken","tokenValid","organizationData","organization","id","Name","NumberOfEmployeesID","AnnualRevenueID","ReachID","error","PeerformanceLogo"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport toast from 'react-hot-toast';\nimport * as fetches from './fetches';\nimport PeerformanceLogo from '../assets/peerformance_logo.svg';\nimport SecurityQuestionsPage from './components/SecurityQuestionsPage';\nimport SubmitPage from './components/SubmitPage';\nimport Notification from '../components/Notification';\nimport { withRouter } from 'react-router-dom';\n\nclass CompanyInformations extends Component {\n\tstate = {\n\t\tisAuth: undefined,\n\t\ttokenError: null,\n\t\tpage: 1,\n\t\tuserEmail: '',\n\t\tquestionsForm: {\n\t\t\tfirstQuestion: {\n\t\t\t\tvalue: '',\n\t\t\t},\n\t\t\tfirstAnswer: {\n\t\t\t\tvalue: '',\n\t\t\t\tisValid: true,\n\t\t\t},\n\t\t\tsecondQuestion: {\n\t\t\t\tvalue: '',\n\t\t\t},\n\t\t\tsecondAnswer: {\n\t\t\t\tvalue: '',\n\t\t\t\tisValid: true,\n\t\t\t},\n\t\t},\n\t\tcompanyInfoForm: {\n\t\t\tisFilled: false,\n\t\t\torganizationId: null,\n\t\t\tname: {\n\t\t\t\tvalue: '',\n\t\t\t},\n\t\t\tnumberOfEmployees: {\n\t\t\t\tvalue: '',\n\t\t\t},\n\t\t\tannualRevenue: {\n\t\t\t\tvalue: '',\n\t\t\t},\n\t\t\treach: {\n\t\t\t\tvalue: '',\n\t\t\t},\n\t\t\tauthorizationContactEmail: {\n\t\t\t\tvalue: '',\n\t\t\t\tisValid: true,\n\t\t\t},\n\t\t},\n\t};\n\n\tasync componentDidMount() {\n\t\tconst search = this.props.location.search;\n\t\tconst params = new URLSearchParams(search);\n\t\tconst token = params.get('token');\n\n\t\tif (token) {\n\t\t\ttry {\n\t\t\t\tconst response = await fetches.checkToken(token);\n\n\t\t\t\tif (response && response.data?.tokenValid) {\n\t\t\t\t\tthis.setIsAuth(true);\n\n\t\t\t\t\tconst organizationData = response?.data.organization;\n\t\t\t\t\tif (organizationData) {\n\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\tcompanyInfoForm: {\n\t\t\t\t\t\t\t\t...this.state.companyInfoForm,\n\t\t\t\t\t\t\t\tisFilled: true,\n\t\t\t\t\t\t\t\torganizationId: organizationData.id,\n\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\tvalue: organizationData.Name,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tnumberOfEmployees: {\n\t\t\t\t\t\t\t\t\tvalue: organizationData.NumberOfEmployeesID,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tannualRevenue: {\n\t\t\t\t\t\t\t\t\tvalue: organizationData.AnnualRevenueID,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\treach: {\n\t\t\t\t\t\t\t\t\tvalue: organizationData.ReachID,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.setState({ isAuth: false, tokenError: response.data.error });\n\t\t\t\t}\n\n\t\t\t\tconst userEmail = response?.data?.email;\n\t\t\t\tif (userEmail) this.setState({ userEmail });\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Token failed: ', error);\n\t\t\t\tthis.setIsAuth(false);\n\t\t\t}\n\t\t}\n\t}\n\n\tnextPage = () => this.setState({ page: 2 });\n\n\tsetIsAuth = (isAuth) => this.setState({ isAuth });\n\n\tsetQuestionFormValue = (e) => {\n\t\tconst { name, value } = e.target;\n\t\tthis.setState((state) => ({\n\t\t\tquestionsForm: {\n\t\t\t\t...state.questionsForm,\n\t\t\t\t[name]: {\n\t\t\t\t\t...state.questionsForm[name],\n\t\t\t\t\tvalue: value,\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\t};\n\n\tsetCompanyInfoFormValue = (e) => {\n\t\tconst { name, value } = e.target;\n\t\tthis.setState((state, _props) => ({\n\t\t\tcompanyInfoForm: {\n\t\t\t\t...state.companyInfoForm,\n\t\t\t\t[name]: {\n\t\t\t\t\t...state.companyInfoForm[name],\n\t\t\t\t\tvalue: value,\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\t};\n\n\tsetAuthorizationContactEmail = (value) => {\n\t\tthis.setState((state, _props) => ({\n\t\t\tcompanyInfoForm: {\n\t\t\t\t...state.companyInfoForm,\n\t\t\t\tauthorizationContactEmail: {\n\t\t\t\t\t...state.companyInfoForm.authorizationContactEmail,\n\t\t\t\t\tvalue: value,\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\t};\n\n\tonSubmit = async () => {\n\t\tconst userData = {\n\t\t\temail: this.state.userEmail,\n\t\t\tfirstQuestion: parseInt(this.state.questionsForm.firstQuestion.value, 10),\n\t\t\tfirstAnswer: this.state.questionsForm.firstAnswer.value,\n\t\t\tsecondQuestion: parseInt(this.state.questionsForm.secondQuestion.value, 10),\n\t\t\tsecondAnswer: this.state.questionsForm.secondAnswer.value,\n\t\t\tauthorizationContactEmail: this.state.companyInfoForm.authorizationContactEmail.value,\n\t\t};\n\n\t\tif (this.state.companyInfoForm.isFilled) {\n\t\t\tconst updatedUserData = Object.assign(\n\t\t\t\t{ organizationId: this.state.companyInfoForm.organizationId },\n\t\t\t\tuserData\n\t\t\t);\n\t\t\ttry {\n\t\t\t\tconst response = await fetches.createUser(updatedUserData);\n\t\t\t\ttoast.success(response.data.message, {\n\t\t\t\t\tduration: 6000,\n\t\t\t\t\tposition: 'top-center',\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t}\n\t\t} else {\n\t\t\tconst companyData = {\n\t\t\t\tname: this.state.companyInfoForm.name.value,\n\t\t\t\tnumberOfEmployees: parseInt(this.state.companyInfoForm.numberOfEmployees.value, 10),\n\t\t\t\tannualRevenue: parseInt(this.state.companyInfoForm.annualRevenue.value, 10),\n\t\t\t\treach: parseInt(this.state.companyInfoForm.reach.value, 10),\n\t\t\t\tdomain: this.state.userEmail.split('@')[1],\n\t\t\t};\n\n\t\t\tconst updatedUserData = Object.assign({ organizationId: null }, userData);\n\n\t\t\ttry {\n\t\t\t\tconst response = await fetches.createCompany(companyData);\n\t\t\t\tupdatedUserData.organizationId = response.data.organizationId;\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst response = await fetches.createUser(updatedUserData);\n\t\t\t\ttoast.success(response.data.message, {\n\t\t\t\t\tduration: 6000,\n\t\t\t\t\tposition: 'top-center',\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t}\n\t\t}\n\n\t\tthis.props.history.push('/');\n\t};\n\n\thandleRefreshToken = async () => {\n\t\tawait fetches.refreshToken(this.state.userEmail);\n\t\tthis.setState({ tokenError: null });\n\t\ttoast.success('Activation link has been sent.', {\n\t\t\tduration: 6000,\n\t\t\tposition: 'top-center',\n\t\t});\n\t\tthis.props.history.push('/');\n\t};\n\n\trender() {\n\t\tconst { questionsForm, companyInfoForm, isAuth, tokenError } = this.state;\n\t\treturn (\n\t\t\t<div className='container'>\n\t\t\t\t<div className='row'>\n\t\t\t\t\t<div className='col-md-5 col-sm-12 mx-auto'>\n\t\t\t\t\t\t<form noValidate className='w-100'>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tclassName='w-50 mx-auto d-block mt-5'\n\t\t\t\t\t\t\t\tsrc={PeerformanceLogo}\n\t\t\t\t\t\t\t\talt='Peerformance Logo'\n\t\t\t\t\t\t\t\twidth='263'\n\t\t\t\t\t\t\t\theight='121'\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t\t{isAuth !== undefined ? (\n\t\t\t\t\t\t\t\tisAuth ? (\n\t\t\t\t\t\t\t\t\t<div className='row mt-3'>\n\t\t\t\t\t\t\t\t\t\t{this.state.page === 1 ? (\n\t\t\t\t\t\t\t\t\t\t\t<SecurityQuestionsPage\n\t\t\t\t\t\t\t\t\t\t\t\tform={questionsForm}\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={this.setQuestionFormValue}\n\t\t\t\t\t\t\t\t\t\t\t\tonNextButtonClick={this.nextPage}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<SubmitPage\n\t\t\t\t\t\t\t\t\t\t\t\tform={companyInfoForm}\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={this.setCompanyInfoFormValue}\n\t\t\t\t\t\t\t\t\t\t\t\tonSubmit={this.onSubmit}\n\t\t\t\t\t\t\t\t\t\t\t\tuserEmail={this.state.userEmail}\n\t\t\t\t\t\t\t\t\t\t\t\tsetAuthorizationContactEmail={\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.setAuthorizationContactEmail\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t) : tokenError ? (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName='alert alert-warning notification-message mt-4'\n\t\t\t\t\t\t\t\t\t\trole='alert'\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t{tokenError}.\n\t\t\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t\t\tIf you would like to renew the account creation process,\n\t\t\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t\t\tclick on this link{' '}\n\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\tclassName='text-decoration-underline text-primary c-pointer'\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.handleRefreshToken}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tlink\n\t\t\t\t\t\t\t\t\t\t\t</span>{' '}\n\t\t\t\t\t\t\t\t\t\t\tand check your e-mail address to complete the activation\n\t\t\t\t\t\t\t\t\t\t\tprocess.\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Notification type='danger' message='Invalid token' />\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) : null}\n\t\t\t\t\t\t</form>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default withRouter(CompanyInformations);\n"]},"metadata":{},"sourceType":"module"}